<!DOCTYPE html>
<html>
<head>
    <title>BALL-E</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <h1>BALL-E</h1>
                <div class="subline">Democratizing trash collection</div>
            </div>
            <div class="header-right">
                <div class="status-pill">
                    <div class="status-indicator" id="globalStatusIndicator"></div>
                    <span id="globalStatusText">Vision Online</span>
                </div>
                <div style="margin-top: 6px;">Team 01</div>
            </div>
        </header>

        <main class="dashboard">
            <section class="left-column">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><span>Feed</span> / Detection Channel</div>
                        <div class="panel-tag">Camera Link</div>
                    </div>
                    <div class="video-layout">
                        <img id="videoFeed" src="/video_feed" width="640" height="480" alt="Video feed">
                        <div class="log-panel">
                            <div class="panel-header" style="margin-bottom: 4px;">
                                <div class="panel-title"><span>Log</span> / Events</div>
                                <div class="panel-tag" id="logCountTag">0 logs</div>
                            </div>
                            <div class="logs" id="logContainer">
                                <div id="logs"></div>
                            </div>
                        </div>
                    </div>
                </div>
            <div class="bottom-row">
                    <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><span>Drive</span> / Mecanum</div>
                        <div class="panel-tag">Wheel Outputs</div>
                    </div>

                    <div class="drive-widget">
                        <div class="drive-meta">
                            <div>Motor powers</div>
                            <div>Normalized [-1, 1]</div>
                        </div>
                        <div class="drive-grid">
                            <div class="drive-wheel" id="wheel-fl">
                                <div class="drive-wheel-header">
                                    <span>FL</span>
                                    <span class="drive-dir" id="wheel-fl-dir">IDLE</span>
                                </div>
                                <div class="drive-bar-shell">
                                    <div class="drive-bar-fill" id="wheel-fl-bar"></div>
                                </div>
                                <div class="drive-wheel-footer">
                                    <div>front left</div>
                                    <div class="drive-value" id="wheel-fl-val">0.00</div>
                                </div>
                            </div>

                            <div class="drive-wheel" id="wheel-fr">
                                <div class="drive-wheel-header">
                                    <span>FR</span>
                                    <span class="drive-dir" id="wheel-fr-dir">IDLE</span>
                                </div>
                                <div class="drive-bar-shell">
                                    <div class="drive-bar-fill" id="wheel-fr-bar"></div>
                                </div>
                                <div class="drive-wheel-footer">
                                    <div>front right</div>
                                    <div class="drive-value" id="wheel-fr-val">0.00</div>
                                </div>
                            </div>

                            <div class="drive-wheel" id="wheel-rl">
                                <div class="drive-wheel-header">
                                    <span>RL</span>
                                    <span class="drive-dir" id="wheel-rl-dir">IDLE</span>
                                </div>
                                <div class="drive-bar-shell">
                                    <div class="drive-bar-fill" id="wheel-rl-bar"></div>
                                </div>
                                <div class="drive-wheel-footer">
                                    <div>rear left</div>
                                    <div class="drive-value" id="wheel-rl-val">0.00</div>
                                </div>
                            </div>

                            <div class="drive-wheel" id="wheel-rr">
                                <div class="drive-wheel-header">
                                    <span>RR</span>
                                    <span class="drive-dir" id="wheel-rr-dir">IDLE</span>
                                </div>
                                <div class="drive-bar-shell">
                                    <div class="drive-bar-fill" id="wheel-rr-bar"></div>
                                </div>
                                <div class="drive-wheel-footer">
                                    <div>rear right</div>
                                    <div class="drive-value" id="wheel-rr-val">0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel pose-panel">
                    <div class="panel-header">
                        <div class="panel-title"><span>Field</span> / Pose</div>
                        <div class="panel-tag">Odometry</div>
                    </div>

                    <div class="pose-widget">
                        <div class="pose-meta">
                            <div>Trash can position</div>
                            <div>Approx open loop</div>
                        </div>
                        <div id="posePlot"></div>
                        <div class="pose-readout">
                            <div id="poseText">
                                x=<span>0.00</span> m,
                                y=<span>0.00</span> m,
                                θ=<span>0.00</span> rad
                            </div>
                        </div>
                    </div>
                </div>

                </div>
            </section>

            <section class="right-column">
                <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><span>Control</span> / Session</div>
                            <div class="panel-tag">Command</div>
                        </div>
                        <div class="controls-row">
                            <div class="controls">
                                <button class="btn-start" onclick="toggleTracking(true)">Start</button>
                                <button class="btn-stop" onclick="toggleTracking(false)">Stop</button>
                                <button class="btn-clear" onclick="clearLogs()">Clear Log</button>
                            </div>
                        </div>
                        <div id="status" class="status status-idle">
                            <div class="status-header">
                                <span>Status</span>
                                <span id="statusModeLabel">Idle</span>
                            </div>
                            <div class="status-line" id="statusLine1">Waiting for box detection.</div>
                            <div class="status-line" id="statusLine2">No active target.</div>
                        </div>
                    </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><span>Motion</span> / Trajectory</div>
                        <div class="panel-tag">Vector Field</div>
                    </div>

                    <div class="motion-widget">
                        <div class="motion-meta">
                            <div>Desired accel / velo</div>
                            <div>Goal: frame center</div>
                        </div>
                        <div id="motionVectorPlot"></div>
                        <div class="motion-readout">
                            <div id="motionVelocityText">v_des: vx=0.0, vy=0.0 px/s</div>
                            <div id="motionAccelText">a_des: ax=0.0, ay=0.0 px/s²</div>
                        </div>
                    </div>

                    <div class="regression-widget">
                        <div class="regression-meta">
                            <div>Traj fit</div>
                            <div>LinReg</div>
                        </div>
                        <div id="regressionPlot"></div>
                    </div>
                </div>
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><span>System</span> / Telemetry</div>
                            <div class="panel-tag" id="cameraModeTag">Arducam Live</div>
                        </div>
                        <div class="stat-grid">
                            <div class="stat-card">
                                <div class="stat-label">Log Count</div>
                                <div class="stat-value" id="statLogs">0</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-label">Frame Rate</div>
                                <div class="stat-value" id="statFPS">0.0 fps</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Trajectory Points</div>
                                <div class="stat-value" id="statTrajectory">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Cam Reso</div>
                                <div class="stat-value" id="statResolution">1280x720</div>
                            </div>
                        </div>
                    </div>
            </section>
        </main>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"> </script>
</body>
</html>
